<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìƒì„¸ì£¼ì†Œ ê²€ìƒ‰</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input[type="text"] { width: 200px; }
    button { margin-top: 15px; padding: 5px 10px; }
    .result-box { margin-top: 20px; }
    .result-box ul { padding-left: 20px; }
    .result-box li { margin: 4px 0; }
    .gray { color: gray; }
  </style>
</head>
<body>

  <h2>ìƒì„¸ì£¼ì†Œ ê²€ìƒ‰ API</h2>
  <form id="addrForm">
    <label>í–‰ì •êµ¬ì—­ì½”ë“œ: <input type="text" name="admCd" value="1135010200"></label>
    <label>ë„ë¡œëª…ì½”ë“œ: <input type="text" name="rnMgtSn" value="113503109006"></label>
    <label>ì§€í•˜ì—¬ë¶€(0=ì§€ìƒ): <input type="text" name="udrtYn" value="0"></label>
    <label>ê±´ë¬¼ë³¸ë²ˆ: <input type="text" name="buldMnnm" value="111"></label>
    <label>ê±´ë¬¼ë¶€ë²ˆ: <input type="text" name="buldSlno" value="0"></label>
    <button type="button" onclick="getDetailAddress()">ìƒì„¸ì£¼ì†Œ ì¡°íšŒ</button>
  </form>

  <div class="result-box" id="result"></div>

  <script>
    function getDetailAddress() {
      const params = new URLSearchParams($("#addrForm").serialize());
      fetch(`/.netlify/functions/addrDetail?` + params)
        .then(response => {
          if (!response.ok) throw new Error("HTTP " + response.status);
          return response.json();
        })
        .then(data => {
          console.log("ğŸ“¦ API ì‘ë‹µ:", data);
          if (!data.results || !data.results.common) {
            throw new Error("API ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜");
          }
          if (data.results.common.errorCode !== "0") {
            $("#result").html(`<p class="gray">âŒ ì˜¤ë¥˜: ${data.results.common.errorMessage}</p>`);
            return;
          }
          const jusoList = data.results.juso;
          if (!jusoList || jusoList.length === 0) {
            $("#result").html('<p class="gray">ğŸ“­ í•´ë‹¹ ì£¼ì†Œì— ìƒì„¸ì£¼ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>');
            return;
          }

          const listItems = jusoList.map(j =>
            `<li>${j.dongNm} ${j.floorNm}ì¸µ ${j.hoNm}</li>`
          ).join('');
          $("#result").html(`<h3>ğŸ“‹ ê²€ìƒ‰ê²°ê³¼ (${jusoList.length}ê±´)</h3><ul>${listItems}</ul>`);
        })
        .catch(error => {
          console.error("âŒ ì˜¤ë¥˜:", error);
          $("#result").html(`<p class="gray">â— ì—ëŸ¬ ë°œìƒ: ${error.message}</p>`);
        });
    }
  </script>

</body>
</html>
